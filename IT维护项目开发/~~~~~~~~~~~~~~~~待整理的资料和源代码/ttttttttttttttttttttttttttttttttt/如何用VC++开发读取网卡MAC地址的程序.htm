<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0045)http://tzsvc.xiloo.com/doc/files/macadree.htm -->
<HTML><HEAD><TITLE>宗胜的编程乐园--文档 <http://tzsvc.xiloo.com></TITLE><!-- #BeginTemplate "/Templates/index3_table.dwt" --><!-- #BeginEditable "doctitle" --><!-- #EndEditable -->
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<STYLE type=text/css>A {
	COLOR: #000000; TEXT-DECORATION: none
}
A:hover {
	TEXT-DECORATION: underline
}
</STYLE>

<SCRIPT language=JAVASCRIPT>
<!-- 
var timerID = null;
var timerRunning = false;
function stopclock (){
if(timerRunning)
clearTimeout(timerID);
timerRunning = false;
}
function showtime () {
var now = new Date();
var hours = now.getHours();
var minutes = now.getMinutes();
var seconds = now.getSeconds()
var timeValue = "现在时间是: " + ((hours >12) ? hours -12 :hours)
timeValue += ((minutes < 10) ? ":0" : ":") + minutes
timeValue += ((seconds < 10) ? ":0" : ":") + seconds
timeValue += (hours >= 12) ? " P.M." : " A.M."
window.status = timeValue;
timerID = setTimeout("showtime()",1000);
timerRunning = true;
}
function startclock () {
stopclock();
showtime();
}
-->
</SCRIPT>

<SCRIPT language=JavaScript>
<!--
function MM_reloadPage(init) {  //reloads the window if Nav4 resized
  if (init==true) with (navigator) {if ((appName=="Netscape")&&(parseInt(appVersion)==4)) {
    document.MM_pgW=innerWidth; document.MM_pgH=innerHeight; onresize=MM_reloadPage; }}
  else if (innerWidth!=document.MM_pgW || innerHeight!=document.MM_pgH) location.reload();
}
MM_reloadPage(true);
// -->
</SCRIPT>

<META content="MSHTML 5.50.4134.100" name=GENERATOR></HEAD>
<BODY text=#000000 bgColor=#ffffff leftMargin=0 onload=startclock()>
<TABLE cellSpacing=0 cellPadding=0 width=772 border=0>
  <TBODY>
  <TR>
    <TD vAlign=top align=left bgColor=#ffffff>
      <TABLE height=8 cellSpacing=0 cellPadding=0 width=776 align=center 
      border=0>
        <TBODY>
        <TR>
          <TD width=311 bgColor=#ffffff height=11><FONT color=#ffffff>　
            <SCRIPT language=JavaScript> <!---
today=new Date();
var hours = today.getHours();
var minutes = today.getMinutes();
var seconds = today.getSeconds();
var timeValue = "<FONT COLOR=black>" + ((hours >12) ? hours -12 :hours); timeValue += ((minutes < 10) ? "<BLINK><FONT COLOR=black>:</FONT></BLINK>0" : "<BLINK><FONT COLOR=black>:</FONT></BLINK>") + minutes+"</FONT></FONT>";
timeValue += (hours >= 12) ? "<FONT COLOR=blue><I><B>pm</B></I></FONT>" : "<FONT COLOR=blue><B><I>am</I></B></FONT>";
function initArray(){
this.length=initArray.arguments.length
for(var i=0;i<this.length;i++)
this[i+1]=initArray.arguments[i] }
var d=new initArray("<font color=RED>星期日","<font color=black>星期一","<font color=black>星期二","<font color=black>星期三","<font color=black>星期四","<font color=black>星期五","<font color=GREEN>星期六"); document.write("<font color=black>",today.getYear(),"<font color=red>年","<font color=black>",today.getMonth()+1,"<font color=red>月","<font color=black>",today.getDate(),"<font color=red>日 </FONT>",d[today.getDay()+1]," ",timeValue); //--></SCRIPT>
             <FONT color=#000000 size=2>登录</FONT></FONT></TD>
          <TD vAlign=bottom align=right width=51 bgColor=#ffffff height=11><A 
            href="http://tzsvc.xiloo.com/index.htm"><IMG height=17 
            src="如何用VC++开发读取网卡MAC地址的程序.files/head.jpg" width=51 border=0></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/mywriting/mywriting.htm"><FONT 
            color=#000000 size=2>作品</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 
            height=11><FONT color=#000000 size=2><A 
            href="http://tzsvc.xiloo.com/firststu/firststu.htm">新手</A></FONT></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/doc/doc.htm"><FONT color=#000000 
            size=2>文章</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/skill/dll.htm"><FONT color=#000000 
            size=2>技巧</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/book/vc.htm"><FONT color=#000000 
            size=2>教程</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/code/code.htm"><FONT color=#000000 
            size=2>源码</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/ks/ks.htm"><FONT color=#000000 
            size=2>考试</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/job/job.htm"><FONT color=#000000 
            size=2>求职</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/download/download.htm"><FONT 
            color=#000000 size=2>下载</FONT></A></TD>
          <TD vAlign=bottom align=middle width=36 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/virus/virus.htm"><FONT color=#000000 
            size=2>病毒</FONT></A></TD>
          <TD vAlign=bottom align=left width=56 bgColor=#e8ecf8 height=11><A 
            href="http://tzsvc.xiloo.com/programmer/programmer.htm"><FONT 
            color=#000000 size=2>人生</FONT></A></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD vAlign=top align=left bgColor=#0070b0></TD></TR>
  <TR vAlign=bottom align=left>
    <TD height=61>
      <TABLE cellSpacing=0 cellPadding=0 width=761 align=center border=0>
        <TBODY>
        <TR>
          <TD width=188 height=49><IMG height=67 
            src="如何用VC++开发读取网卡MAC地址的程序.files/zititle.jpg" width=187></TD>
          <TD width=452 height=49><A 
            href="http://asiafriendfinder.com/go/f122344"><IMG height=67 src="" 
            width=450 align=absBottom border=0></A></TD>
          <TD width=121 height=49><FONT size=2><IFRAME border=0 
            src="如何用VC++开发读取网卡MAC地址的程序.files/showlink.htm" frameBorder=0 
            width=120 scrolling=no 
    height=60></IFRAME></FONT></TD></TR></TBODY></TABLE></TD></TR>
  <TR bgColor=#0070b0>
    <TD><FONT color=#ffffff size=2><FONT size=2>　|<A target=_blank 
      href="http://vcbbs888.xilubbs.com/"><FONT color=#ffffff 
      size=2>编程论坛</FONT></A>|<A target=_blank 
      href="http://www.sn163.net/cgi-bin/gb2000/gb.cgi?id=tangzs"><FONT 
      color=#ffffff size=2>请您留言</FONT></A>|</FONT><A target=_blank 
      href="mailto:tzs168@yahoo.com.cn"><FONT color=#ffffff 
      size=2>联系我们</FONT></A>|</FONT></TD></TR>
  <TR>
    <TD vAlign=top align=left>
      <TABLE cellSpacing=0 cellPadding=0 width=777 border=0>
        <TBODY>
        <TR>
          <TD vAlign=top align=middle width=165 bgColor=#e8ecf8 
            height=104><IMG height=60 src="如何用VC++开发读取网卡MAC地址的程序.files/word.jpg" 
            width=140><BR><BR><FONT size=2><A 
            href="http://tzsvc.xiloo.com/other/new.htm">本站更新列表&gt;&gt;</A></FONT><BR><BR><FONT 
            size=2><A 
            href="http://tzsvc.xiloo.com/other/goodpage.htm">好站链接&gt;&gt;</A></FONT><BR></TD>
          <TD vAlign=top align=left width=12 height=104><IMG height=15 src="" 
            width=10></TD>
          <TD vAlign=top align=left width=600 height=104>
            <TABLE cellSpacing=0 cellPadding=0 width=599 border=0>
              <TBODY>
              <TR>
                <TD><FONT size=2>日期:2002/<!-- #BeginEditable "date" -->10/19<!-- #EndEditable -->　　　　　　　　　　　　　　　　　　　　　　　　文章出处:<!-- #BeginEditable "from" -->csdn<!-- #EndEditable --></FONT></TD></TR>
              <TR>
                <TD><FONT 
                  size=2>标题:<!-- #BeginEditable "title" --><B>如何用VC++开发读取网卡MAC地址的程序</B> 
<!-- #EndEditable --></FONT></TD></TR>
              <TR>
                <TD><!-- #BeginEditable "other" --><!-- #EndEditable --></TD></TR>
              <TR>
                <TD vAlign=top align=left><!-- #BeginEditable "data" --><FONT 
                  size=2><BR>广东省深圳市 <BR>温卫红 <BR>---- 
                  在实际的应用系统中，我们往往会需要在程序运行时获取当前机器的网卡的MAC地址，以便作为某种标识之用，如控制程序的合法性等。下文就如何用Microsoft 
                  Visual C++ 6.0开发这样的程序演示如何实现其要点。 </FONT>
                  <P><FONT size=2>---- 这里采用的方法是通过Windows 
                  9x/NT/Win2000中内置的NetApi32.DLL的功能来实现的，首先通过发送NCBENUM命令获取网卡的数目和每个网卡的内部编号，然后对每个网卡标号发送NCBASTAT命令获取其MAC地址。注意：这里的网卡是指捆绑了NetBeui协议的通信协议栈，可以在网卡的属性处查看到。 
                  </FONT></P>
                  <P><FONT size=2>---- 请运行VC++，打开一个新的工程，选择创建一个Win32 
                  Console程序，然后按下文输入代码，并请参见其中的注释： </FONT></P>
                  <P><FONT size=2>#include "stdafx.h"</FONT></P>
                  <P><FONT size=2>#include &lt; windows.h &gt;<BR>#include &lt; 
                  wincon.h &gt;<BR>#include &lt; stdlib.h &gt;<BR>#include &lt; 
                  stdio.h &gt;<BR>#include &lt; time.h &gt;</FONT></P>
                  <P><FONT size=2>---- // 因为是通过NetAPI来获取网卡信息， 所以需要包含其题头文件nb30.h 
                  #include &lt; nb30.h &gt; <BR>typedef struct 
                  _ASTAT_<BR>{<BR>ADAPTER_STATUS adapt;<BR>NAME_BUFFER NameBuff 
                  [30];<BR>}ASTAT, * PASTAT;</FONT></P>
                  <P><FONT size=2>ASTAT Adapter; </FONT></P>
                  <P><FONT size=2>---- // 定义一个存放返回网卡信息的变量 <BR>---- // 
                  输入参数：lana_num为网卡编号，一般地，从0开始，但在Windows 2000中并不一定是连续分配的 
                  </FONT></P>
                  <P><FONT size=2>void getmac_one (int lana_num)<BR>{<BR>NCB 
                  ncb;<BR>UCHAR uRetCode;</FONT></P>
                  <P><FONT size=2>memset( &amp;ncb, 0, sizeof(ncb) 
                  );<BR>ncb.ncb_command = NCBRESET;<BR>ncb.ncb_lana_num = 
                  lana_num; <BR>// 指定网卡号</FONT></P>
                  <P><FONT size=2>---- // 首先对选定的网卡发送一个NCBRESET命令，以便进行初始化 
                  <BR>uRetCode = Netbios( &amp;ncb );<BR>printf( "The NCBRESET 
                  return code is:<BR>0x%x \n", uRetCode );</FONT></P>
                  <P><FONT size=2>memset( &amp;ncb, 0, sizeof(ncb) 
                  );<BR>ncb.ncb_command = NCBASTAT;<BR>ncb.ncb_lana_num = 
                  lana_num; // 指定网卡号</FONT></P>
                  <P><FONT size=2>strcpy( (char *)ncb.ncb_callname, <BR>"* " 
                  );<BR>ncb.ncb_buffer = (unsigned char *) 
                  &amp;Adapter;</FONT></P>
                  <P><FONT size=2>---- // 指定返回的信息存放的变量 <BR>ncb.ncb_length = 
                  sizeof(Adapter);</FONT></P>
                  <P><FONT size=2>---- // 接着，可以发送NCBASTAT命令以获取网卡的信息 <BR>uRetCode 
                  = Netbios( &amp;ncb );<BR>printf( "The NCBASTAT <BR>return 
                  code is: 0x%x \n", uRetCode );<BR>if ( uRetCode == 0 
                  )<BR>{</FONT></P>
                  <P><FONT size=2>---- // 把网卡MAC地址格式化成常用的16进制形式，如0010-A4E4-5802 
                  <BR>printf( "The Ethernet Number[%d]<BR>is: 
                  %02X%02X-%02X%02X-%02X%02X\n",<BR>lana_num,<BR>Adapter.adapt.adapter_address[0],<BR>Adapter.adapt.adapter_address[1],<BR>Adapter.adapt.adapter_address[2],<BR>Adapter.adapt.adapter_address[3],<BR>Adapter.adapt.adapter_address[4],<BR>Adapter.adapt.adapter_address[5] 
                  );<BR>}<BR>}</FONT></P>
                  <P><FONT size=2>int main(int argc, char* argv[]) <BR>{<BR>NCB 
                  ncb;<BR>UCHAR uRetCode;<BR>LANA_ENUM lana_enum;</FONT></P>
                  <P><FONT size=2>memset( &amp;ncb, 0, sizeof(ncb) 
                  );<BR>ncb.ncb_command = NCBENUM;</FONT></P>
                  <P><FONT size=2>ncb.ncb_buffer = (unsigned char *) 
                  &amp;lana_enum;<BR>ncb.ncb_length = 
                  sizeof(lana_enum);</FONT></P>
                  <P><FONT size=2>---- // 
                  向网卡发送NCBENUM命令，以获取当前机器的网卡信息，如有多少个网卡、每张网卡的编号等 <BR>uRetCode = 
                  Netbios( &amp;ncb );<BR>printf( "The NCBENUM return<BR>code 
                  is: <BR>0x%x \n", uRetCode );<BR>if ( uRetCode == 0 
                  )<BR>{<BR>printf( "Ethernet Count is : %d\n\n", 
                  lana_enum.length);</FONT></P>
                  <P><FONT size=2>---- // 对每一张网卡，以其网卡编号为输入编号，获取其MAC地址 <BR>for ( 
                  int i=0; i&lt; lana_enum.length; ++i)<BR>getmac_one( 
                  lana_enum.lana[i]);<BR>}<BR>return 0;<BR>}</FONT></P>
                  <P><FONT size=2>---- 此时，按F7编译、直至通过，按F5运行即可。 <BR>---- 
                  这段代码可以直接嵌入相关的应用系统之中，或封装成.DLL或COM控件，以便可以在Visual Basic、Visual 
                  Foxpro、Power Builder或Delphi等其他程序中调用。</FONT></P>
                  <P></P><!-- #EndEditable --></TD></TR>
              <TR>
                <TD align=middle><FONT size=2>上一页 第0页 下一页</FONT></TD></TR>
              <TR>
                <TD align=middle><FONT size=2><INPUT onclick=history.go(-1) type=button value=后退 name=button> 
<INPUT onclick=history.go(1) type=button value=前进 name=button2> 
<INPUT onclick=window.close() type=button value=关闭 name=button3> 
                  </FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=764 align=center border=0>
  <TBODY>
  <TR>
    <TD>
      <HR SIZE=1>
    </TD></TR>
  <TR>
    <TD align=middle><FONT size=2>Copyright(c)2002 
      宗胜的编程乐园　http://tzsvc.xiloo.com <BR>文章版权归原作者所有，如仍有问题，请与我联系 </FONT></TD></TR>
  <TR>
    <TD>
      <HR SIZE=1>
    </TD></TR></TBODY></TABLE><!-- #EndTemplate --></BODY></HTML>
