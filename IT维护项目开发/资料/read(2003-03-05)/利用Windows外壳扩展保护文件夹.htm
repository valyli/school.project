<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0045)http://www.vcroad.net/shownews.asp?newsid=458 -->
<HTML><HEAD><TITLE>VC 之路：：综合软件开发网站，以VC++编程为主</TITLE>
<SCRIPT language=JavaScript>
var currentpos,timer;

function initialize()
{
timer=setInterval("scrollwindow()",50);
}
function sc(){
clearInterval(timer);
}
function scrollwindow()
{
currentpos=document.body.scrollTop;
window.scroll(0,++currentpos);
if (currentpos != document.body.scrollTop)
sc();
}
document.onmousedown=sc
document.ondblclick=initialize
</SCRIPT>

<META content="text/html; charset=gb2312" http-equiv=Content-Type>
<META content="MSHTML 5.00.3502.5390" name=GENERATOR>
<META content=FrontPage.Editor.Document name=ProgId>
<META 
content="vcroad sdkroad VC之路  VC站点　VC编程　VC开发 程序人生　C++编程　SDK编程　API编程 网络编程　数据库编程　VC知识库 VC代码库　VC指南 Visual C++ 初学指南 技术写译  数据结构　算法　编程文摘 源代码 MFC VC资源 论坛 电子刊物 程序员 vc++ vc  编程 开发 visual c mfc 代码 图书 文章 开发工具 免费 合作开发 合作 dot net NET VS.NET VC7 VC6 programer atl stl com .net cnn china chinese sex softwares windows programmer programming  developer 软件 共享 行业 技术 开发 论坛 新闻 专家门诊 程序员大本营 VC VB Delphi ASP PHP Perl SQL" 
name=keywords>
<META content="Visual C++专业站点，初学指南，电子杂志,电子图书，技术写译，编程文摘，程序源代码，以及其它VC MFC相关资源" 
name=description>
<META content="default index,follow" name=robots>
<STYLE>.textb {
	BACKGROUND-COLOR: #dddddd; BORDER-BOTTOM: #000000 1px solid; BORDER-LEFT: #999999 0px solid; BORDER-RIGHT: #999999 0px solid; BORDER-TOP: #999999 0px solid; CURSOR: hand; FONT-SIZE: 9pt
}
.submit {
	BACKGROUND-COLOR: #cfcfc9; BORDER-BOTTOM: #999999 1px solid; BORDER-LEFT: #e0e7e0 1px solid; BORDER-RIGHT: #999999 1px solid; BORDER-TOP: #e0e7e0 1px solid; CURSOR: hand; FONT-SIZE: 9pt; HEIGHT: 18px
}
TD {
	COLOR: #0000cc; FONT-SIZE: 12px; LINE-HEIGHT: 150%
}
A:visited {
	COLOR: #000066
}
A:link {
	COLOR: #0000cc
}
A:hover {
	COLOR: #ff0000
}
INPUT {
	BACKGROUND-COLOR: #f6f6f6; BORDER-BOTTOM: #000000 1px solid; BORDER-LEFT: #000000 1px solid; BORDER-RIGHT: #000000 1px solid; BORDER-TOP: #000000 1px solid; FONT-SIZE: 9pt; HEIGHT: 20px; POSITION: relative
}
TEXTAREA {
	BACKGROUND-COLOR: #efefef; BORDER-BOTTOM: 1px solid; BORDER-LEFT: 1px solid; BORDER-RIGHT: 1px solid; BORDER-TOP: 1px solid; FONT-SIZE: 9pt
}
SELECT {
	BACKGROUND-COLOR: #f6f6f6; FONT-SIZE: 9pt
}
.TableLine {
	BORDER-COLLAPSE: collapse
}
</STYLE>
<LINK href="利用Windows外壳扩展保护文件夹.files/style.css" rel=stylesheet>
<SCRIPT src="利用Windows外壳扩展保护文件夹.files/Js.js"></SCRIPT>
</HEAD>
<BODY bgColor=#ffffff leftMargin=0 topMargin=0>
<DIV align=center><!--第一行开始-->
<TABLE bgColor=#000000 border=0 cellPadding=0 cellSpacing=0 width="98%">
  <TBODY>
  <TR>
    <TD width=0%>&nbsp;</TD>
    <TD class=top1 width="3%"><IMG border=0 hspace=3 
      src="利用Windows外壳扩展保护文件夹.files/TOPL.gif"></TD>
    <TD class=top1 width="19%">&nbsp;</TD>
    <TD align=right class=top1 width="74%">
      <DIV align=right><A class=top1 
      href="http://www.vcroad.net/shownews.asp?newsid=278" 
      target=_blank>关于我们</A><FONT color=#ffffff> |</FONT> <A class=top1 
      href="http://www.vcroad.net/showsearch.asp">资料搜索</A> <FONT 
      color=#ffffff>|</FONT> <A class=top1 
      href="http://www.vcroad.net/User.asp">关于会员</A> <FONT 
      color=#ffffff>|</FONT> <A class=top1 
      href="http://www.vcroad.net/tougao.asp" target=_blank>投稿说明</A> <FONT 
      color=#ffffff>| </FONT><A class=top1 href="http://www.vcroad.net/forum/" 
      target=_blank>开发社区</A><FONT color=#ffffff> |</FONT> </DIV></TD>
    <TD align=right class=top1 width="3%"><IMG border=0 height=15 hspace=3 
      src="利用Windows外壳扩展保护文件夹.files/TOPR.gif" width=15></TD>
    <TD width="1%"></TD></TR></TBODY></TABLE>
<TABLE border=0 cellPadding=0 cellSpacing=0 width=755>
  <TBODY>
  <TR bgColor=#ffffff>
    <TD height=1></TD></TR></TBODY></TABLE>
<TABLE bgColor=#ffffff border=0 borderColorLight=#ffffff cellPadding=0 
cellSpacing=0 class=TableLine width="98%">
  <TBODY>
  <TR>
    <TD background=利用Windows外壳扩展保护文件夹.files/pic_point1.gif height=84 
    width="1%"></TD>
    <TD align=middle background=利用Windows外壳扩展保护文件夹.files/pic_point1.gif 
    height=84 vAlign=center width="19%"><A 
      href="http://www.vcroad.net/default.asp"><IMG alt=综合软件开发网，以VC开发为主 border=0 
      height=53 src="利用Windows外壳扩展保护文件夹.files/logo.gif" width=125></A> </TD>
    <TD background=利用Windows外壳扩展保护文件夹.files/pic_point1.gif height=84 
width="68%">
      <DIV align=center>
      <OBJECT classid=clsid:D27CDB6E-AE6D-11cf-96B8-444553540000 
      codeBase=http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0 
      height=66 width=480><PARAM NAME="movie" VALUE="images/Flash/vcroad.swf"><PARAM NAME="quality" VALUE="high">
                                    <embed src="images/Flash/vcroad.swf" 
      quality=high 
      pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" 
      type="application/x-shockwave-flash" width="480" height="66">          
      </embed>         </OBJECT></DIV></TD>
    <TD align=middle background=利用Windows外壳扩展保护文件夹.files/pic_point1.gif 
    height=84 vAlign=center width="11%">
      <TABLE align=right border=0 cellPadding=0 cellSpacing=1>
        <TBODY>
        <TR>
          <TD align=middle vAlign=center><IMG height=16 
            src="利用Windows外壳扩展保护文件夹.files/home.gif" width=16><A href="http:///#" 
            onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http:///')"></A></TD>
          <TD align=middle vAlign=center><A class=top4 
            href="http://www.vcroad.net/shownews.asp?newsid=458#" 
            onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.vcroad.com');">设为首页</A></TD></TR>
        <TR>
          <TD align=middle vAlign=center><IMG height=16 
            src="利用Windows外壳扩展保护文件夹.files/hf.gif" width=16><A 
          href="mailto:"></A></TD>
          <TD align=middle vAlign=center><A class=top4 
            href="mailto:vcroad@sina.com">联系我们</A></TD></TR>
        <TR>
          <TD align=middle vAlign=center><IMG height=13 
            src="利用Windows外壳扩展保护文件夹.files/bookmark.gif" width=15><A 
            href="http:///" 
            title="onClick=&quot;window.external.addFavorite('http:///','')&quot;"></A></TD>
          <TD align=middle vAlign=center><A class=top4 
            href="http://www.vcroad.net/shownews.asp?newsid=458#" 
            onclick="javascript:window.external.AddFavorite('http://www.vcroad.com', 'VC之路：：综合软件开发网站，以VC++编程为主')">加入收藏</A></TD></TR></TBODY></TABLE></TD>
    <TD background=利用Windows外壳扩展保护文件夹.files/pic_point1.gif height=84 
    width="1%"></TD></TR></TBODY></TABLE>
<TABLE bgColor=#666666 cellPadding=0 cellSpacing=0 width="98%">
  <TBODY>
  <TR>
    <TD bgColor=#ffffff width="100%">
      <TABLE border=0 cellPadding=0 cellSpacing=1 width="100%">
        <TBODY>
        <TR bgColor=#000033>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=1&amp;BigClassName=程序人生&amp;BigClassType=1">程序人生</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=2&amp;BigClassName=开发指南&amp;BigClassType=1">开发指南</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=3&amp;BigClassName=CPP 文档&amp;BigClassType=1">CPP 
                  文档</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=4&amp;BigClassName=SDK 文档&amp;BigClassType=1">SDK 
                  文档</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=5&amp;BigClassName=MFC 文档&amp;BigClassType=1">MFC 
                  文档</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=7&amp;BigClassName=专题文档&amp;BigClassType=1">专题文档</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=8&amp;BigClassName=在线教程&amp;BigClassType=1">在线教程</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=9&amp;BigClassName=代码中心&amp;BigClassType=1">代码中心</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#000033 height=18>
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#666666>
                <TD height=19>
                  <DIV align=center><SPAN class=lianjie2><A class=top3 
                  href="http://www.vcroad.net/BigClass.asp?BigClassID=10&amp;BigClassName=资源中心&amp;BigClassType=1">资源中心</A></SPAN></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<TABLE border=0 cellPadding=0 cellSpacing=0 width="98%">
  <TBODY>
  <TR>
    <TD bgColor=#ffffff width=1></TD>
    <TD align=left bgColor=#ffffff class=top4 height=20 
    style="BORDER-BOTTOM: #000000 1px double">
      <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
      cellPadding=0 cellSpacing=0 width="100%">
        <TBODY>
        <TR bgColor=#e4e4e4>
          <TD height=19>
            <DIV align=left></DIV>
          <TD align=left bgColor=#ffffff class=top4 height=20 
          style="BORDER-BOTTOM: #000000 1px double">
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#e4e4e4>
                <TD height=19>
                  <DIV align=left><IMG border=0 
                  src="利用Windows外壳扩展保护文件夹.files/where.gif">&nbsp;当前位置：<A 
                  class=top4 href="http://www.vcroad.net/default.asp">首 页</A> 
                  &gt; 阅读文章 </DIV></TD></TR></TBODY></TABLE></TD>
          <TD align=middle bgColor=#ffffff class=top4 height=20 
          style="BORDER-BOTTOM: #000000 1px double">
            <TABLE border=1 borderColorDark=#ffffff borderColorLight=#cccccc 
            cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR bgColor=#e4e4e4>
                <TD height=19>
                  <DIV align=center><A href="javascript:window.print()"><IMG 
                  alt=打印本页 border=0 height=14 
                  src="利用Windows外壳扩展保护文件夹.files/printer.gif" 
                width=16></A></DIV></TD></TR></TBODY></TABLE></TD>
          <TD bgColor=#ffffff width=1></TD></TR></TBODY></TABLE>
      <TABLE align=center border=0 cellPadding=0 cellSpacing=0 width="99%">
        <TBODY>
        <TR>
          <TD width="79%">&nbsp; </TD>
          <TD width="21%">
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD width=0%>&nbsp;</TD>
                <TD bgColor=#ffffff width="20%">
                  <DIV align=center><IMG height=19 
                  src="利用Windows外壳扩展保护文件夹.files/title_new_left.gif" 
                  width=39></DIV></TD>
                <TD bgColor=#666666 width="80%">
                  <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
                    <TBODY>
                    <TR>
                      <TD bgColor=#666666 height=10 width="23%">
                        <DIV align=center></DIV></TD>
                      <TD bgColor=#666666 height=10 width="38%">
                        <DIV align=right></DIV></TD>
                      <TD bgColor=#666666 height=10 width="39%">
                        <DIV align=right><IMG height=19 
                        src="利用Windows外壳扩展保护文件夹.files/title_right_2.jpg" 
                        width=60></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
      <TABLE align=center bgColor=#666666 border=0 cellPadding=0 cellSpacing=0 
      width="99%">
        <TBODY>
        <TR>
          <TD height=6></TD></TR></TBODY></TABLE>
      <TABLE align=center border=0 cellPadding=0 cellSpacing=0 width="99%">
        <TBODY>
        <TR>
          <TD height=178 width="79%">
            <TABLE align=center border=0 cellPadding=0 cellSpacing=0 
            style="TABLE-LAYOUT: fixed" width="100%">
              <TBODY>
              <TR></TR>
              <TR>
                <TD align=middle class=NEWSREADME colSpan=2>
                  <TABLE bgColor=#009933 border=1 borderColorDark=#ffffff 
                  borderColorLight=#cccccc cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR bgColor=#e4e4e4>
                      <TD height=4>
                        <DIV align=center><IMG height=16 
                        src="利用Windows外壳扩展保护文件夹.files/note.jpg" width=16> 
                        <B>利用Windows外壳扩展保护文件夹</B></DIV></TD></TR></TBODY></TABLE>
                  <P>时间：2002-10-16 20:53:57&nbsp;阅读 <FONT 
                  color=#ff0000>481</FONT> 次</P></TD></TR>
              <TR>
                <TD align=middle colSpan=2>
                  <TABLE align=center border=0 cellPadding=0 cellSpacing=0 
                  style="TABLE-LAYOUT: fixed" width="98%">
                    <TBODY>
                    <TR>
                      <TD class=news 
                        style="WORD-WRAP: break-word">作者:TechnoFantasy<BR><BR><BR><BR>在Win32操作系统（包括Win9X、Windows 
                        NT、Windows 
                        2000）不但有方便的图形用户（GUI）界面，微软还为windows用户界面保留了强大的可扩充性。其中对于Windows界面的操作环境（这里称为外壳Shell），微软提供了一种称为外壳扩展（Shell 
                        Extensions）的功能来实现文件系统操作的可编程性。如果你的机器中安装了Word 
                        7.0以上的版本，当你鼠标右键单击一个DOC文件，在弹出菜单中选“属性”项，在属性页中不仅显示显示文件的大小、建立日期等信息，同时还增加了Doc文档的摘要、统计等信息；又例如安装了winZip 
                        6.0以上版本后，当选中一个或多个文件或文件夹后在单击鼠标右键，在弹出的右键菜单中就增加了“Add To 
                        Zip”等一个zip文件压缩选项。上面的这些功能都是通过Windows外壳扩展来实现的。<BR>Windows外壳扩展是这样实现的。首先要编写外壳扩展程序，一个外壳扩展程序是基于COM(Component 
                        Object 
                        Model)组件模型的。外壳是通过接口(Interface)来访问对象的。外壳扩展被设计成32位的进程中服务器程序，并且都是以动态链接库的形式为操作系统提供服务的。<BR>写好外壳扩展程序后，必须将它们注册才能生效。所有的外壳扩展都必须在Windows注册表的HKEY_CLASSES_ROOT\CLSID键之下进行注册。在该键下面可以找到许多名字像{ACDE002F-0000-0000-C000-000000000046}的键，这类键就是全局唯一类标识符。每一个外壳扩展都必须有一个全局唯一类标识符，Windows正是通过此唯一类标识符来找到外壳扩展处理程序的。在类标识符之下的InProcServer32子键下记录着外壳扩展动态链接库在系统中的位置。<BR><BR>Windows系统支持以下7类的外壳扩展功能：<BR>(1)Context 
                        menu handlers向特定类型的文件对象增添上下文相关菜单； <BR>(2)Drag-and-drop 
                        handlers用来支持当用户对某种类型的文件对象进行拖放操作时的OLE数据传输； <BR>(3)Icon 
                        handlers用来向某个文件对象提供一个特有的图标，也可以给某一类文件对象指定图标； 
                        <BR>(4)Property sheet 
                        handlers给文件对象增添属性页，属性页可以为同一类文件对象所共有，也可以给一个文件对象指定特有的属性页； 
                        <BR>(5)Copy-hook 
                        handlers在文件夹对象或者打印机对象被拷贝、移动、删除和重命名时，就会被系统调用，通过为Windows增加Copy-hook 
                        handlers，可以允许或者禁止其中的某些操作； <BR>(6)Drop target 
                        handlers在一个对象被拖放到另一个对象上时，就会被系统被调用； <BR>(7)Data object 
                        handlers在文件被拖放、拷贝或者粘贴时，就会被系统被调用。<BR>本文介绍的文件夹保护功能就是通过上面的第5类，既Copy-hook 
                        handlers来实现的。一个支持Copy-hook 
                        handlers的程序除了上面提到的要在注册表的HKEY_CLASSES_ROOT\CLSID下注册之外，还需要在HKEY_CLASSES_ROOT\Directory\shellex\CopyHookHandlers\下注册服务器程序的类。<BR>由于Windows外壳服务器程序是基于COM组件模型的，所以编写外壳程序就是构造一个COM对象的过程，由于Delphi4.0以上的版本支持Windows外壳扩展和COM组件模型，所以可以利用Delphi来编写外壳扩展程序。<BR>利用Delphi编写Copy-hook 
                        handle需要实现ICopyHook接口。ICopyHook是一个十分简单的接口，要实现的只有CopyCallBack方法。ICopyHook的CopyCallBack方法的定义如下：<BR>UINT 
                        CopyCallback(<BR>HWND hwnd, file://Handle/ of the parent 
                        window for displaying UI objects<BR>UINT wFunc, 
                        file://Operation/ to perform.<BR>UINT wFlags, 
                        file://Flags/ that control the operation<BR>LPCSTR 
                        pszSrcFile, file://Pointer/ to the source file<BR>DWORD 
                        dwSrcAttribs, file://Source/ file attributes<BR>LPCSTR 
                        pszDestFile, file://Pointer/ to the destination 
                        file<BR>DWORD dwDestAttribs file://Destination/ file 
                        attributes<BR>);<BR>其中的参数hwnd是一个窗口句柄，Copy-hook 
                        handle以此为父窗口。参数wFunc指定要被执行的操作，其取值为下表中所列之一：<BR>常量 取值 
                        含义<BR>FO_COPY $2 
                        复制由pszSrcFile指定的文件到由pszDestFile指定的位置。<BR>FO_DELETE $3 
                        删除由pszSrcFile指定的文件。<BR>FO_MOVE $1 
                        移动由pszSrcFile指定的文件到由pszDestFile指定的位置。<BR>FO_RENAME $4 
                        重命名由pszSrcFile指定的文件到由pszDestFile指定的文件名。<BR>PO_DELETE $13 
                        删除pszSrcFile指定的打印机。<BR>PO_PORTCHANGE $20 
                        改变打印机端口。PszSrcFile和pszDestFile为两个以Null结尾的字符串，分别指定当前和新的打印机端口名。<BR>PO_RENAME 
                        $14 重命名由pszSrcFile指定的打印机端口。<BR>PO_REN_PORT $34 
                        PO_RENAME和PO_PORTCHANGE的组合。<BR><BR>参数wFlags指定操作的标志；参数pszSrcFile和pszDestFile指定源文件夹和目标文件夹。参数dwSrcAttribs和dwDesAttribs指定源文件夹和目标文件夹的属性。函数返回值可以为IDYES、IDNO和IDCANCEL。分别指示Windows外壳允许操作、阻止操作，但是其他操作继续、阻止当前操作，取消为执行的操作。<BR>下面是具体的程序实现：<BR>首先在Delphi的菜单中选 
                        File|New选项，选择其中的DLL图标，按Ok键建立一个DLL工程文件，在其中添加以下代码：<BR>library 
                        CopyHook;<BR><BR>uses<BR>ComServ,<BR>CopyMain in 
                        ’CopyMain.pas’;<BR><BR>exports<BR>DllGetClassObject,<BR>DllCanUnloadNow,<BR>DllRegisterServer,<BR>DllUnregisterServer;<BR><BR>{$R 
                        *.TLB}<BR><BR>{$R *.RES}<BR><BR>begin<BR>end.<BR>将文件保存为 
                        CopyHook.dpr。再在Delphi菜单中选File|New选项，选择其中的Unit图标，按Ok键建立一个Pas文件，在其中加入以下代码：<BR>unit 
                        CopyMain;<BR><BR>interface<BR><BR>uses Windows, ComObj, 
                        ShlObj;<BR><BR>type<BR>TCopyHook = class(TComObject, 
                        ICopyHook)<BR>protected<BR>function CopyCallback(Wnd: 
                        HWND; wFunc, wFlags: UINT; pszSrcFile: 
                        PAnsiChar;<BR>dwSrcAttribs: DWORD; pszDestFile: 
                        PAnsiChar; dwDestAttribs: DWORD): UINT; 
                        stdcall;<BR>end;<BR><BR>TCopyHookFactory = 
                        class(TComObjectFactory)<BR>protected<BR>function 
                        GetProgID: string; override;<BR>procedure 
                        ApproveShellExtension(Register: Boolean; const ClsID: 
                        string);<BR>virtual;<BR>public<BR>procedure 
                        UpdateRegistry(Register: Boolean); 
                        override;<BR>end;<BR><BR>implementation<BR><BR>uses 
                        ComServ, SysUtils, Registry;<BR><BR>{ TCopyHook 
                        }<BR><BR>file://当/Windows外壳程序执行文件夹或者打印机端口操作时，CopyCallBack<BR>file://方/法就会被调用。<BR>function 
                        TCopyHook.CopyCallback(Wnd: HWND; wFunc, wFlags: 
                        UINT;<BR>pszSrcFile: PAnsiChar; dwSrcAttribs: DWORD; 
                        pszDestFile: PAnsiChar;<BR>dwDestAttribs: DWORD): 
                        UINT;<BR>const<BR>FO_COPY = 2;<BR>FO_DELETE = 
                        3;<BR>FO_MOVE = 1;<BR>FO_RENAME = 
                        4;<BR>var<BR>sOp:string;<BR>begin<BR>Case wFunc 
                        of<BR>FO_COPY: sOp:=format(’你确定要将 %s 拷贝到 %s 
                        吗？’,[pszSrcFile,pszDestFile]);<BR>FO_DELETE: 
                        sOp:=format(’你确定要将 %s 删除吗？’,[pszSrcFile]);<BR>FO_MOVE: 
                        sOp:=format(’你确定要将 %s 转移到 %s 
                        吗？’,[pszSrcFile,pszDestFile]);<BR>FO_RENAME: 
                        sOp:=format(’你确定要将 %s 重命名为 %s 
                        吗？’,[pszSrcFile,pszDestFile]);<BR>else<BR>sOp:=format(’无法识别的操作代码 
                        %d’,[wFlags]);<BR>end;<BR>// 提示，让用户决定是否执行操作<BR>Result := 
                        MessageBox(Wnd, PChar(sOp),<BR>’文件挂钩演示’, 
                        MB_YESNOCANCEL);<BR>end;<BR><BR>{ TCopyHookFactory 
                        }<BR><BR>function TCopyHookFactory.GetProgID: 
                        string;<BR>begin<BR>Result := 
                        ’’;<BR>end;<BR><BR>procedure 
                        TCopyHookFactory.UpdateRegistry(Register: 
                        Boolean);<BR>var<BR>ClsID: string;<BR>begin<BR>ClsID := 
                        GUIDToString(ClassID);<BR>inherited 
                        UpdateRegistry(Register);<BR>ApproveShellExtension(Register, 
                        ClsID);<BR>if Register then<BR>file://将/clsid 
                        加入到注册表的CopyHookHandlers中<BR>CreateRegKey(’directory\shellex\CopyHookHandlers\’ 
                        + ClassName, 
                        ’’,<BR>ClsID)<BR>else<BR>DeleteRegKey(’directory\shellex\CopyHookHandlers\’ 
                        + ClassName);<BR>end;<BR><BR>procedure 
                        TCopyHookFactory.ApproveShellExtension(Register: 
                        Boolean;<BR>const ClsID: 
                        string);<BR>const<BR>SApproveKey = 
                        ’SOFTWARE\Microsoft\Windows\CurrentVersion\Shell 
                        Extensions\Approved’;<BR>begin<BR>with TRegistry.Create 
                        do<BR>try<BR>RootKey := HKEY_LOCAL_MACHINE;<BR>if not 
                        OpenKey(SApproveKey, True) then Exit;<BR>if Register 
                        then WriteString(ClsID, Description)<BR>else 
                        DeleteValue(ClsID);<BR>finally<BR>Free;<BR>end;<BR>end;<BR><BR>const<BR>CLSID_CopyHook: 
                        TGUID = 
                        ’{66CD5F60-A044-11D0-A9BF-00A024E3867F}’;<BR>LIBID_CopyHook: 
                        TGUID = 
                        ’{D2F531A0-0861-11D2-AE5C-74640BC10000}’;<BR><BR>initialization<BR>TCopyHookFactory.Create(ComServer, 
                        TCopyHook, CLSID_CopyHook,<BR>’CR_CopyHook’, 
                        ’文件操作挂钩演示’,ciMultiInstance, 
                        tmApartment);<BR>end.<BR>将文件保存为CopyMain.Pas文件，然后编译程序为CopyHook.Dll文件，然后注册CopyHook.Dll文件，你可以使用Windows提供的RegSvr32.exe来注册，注册的方法是在Dos窗口中进入Windows的System子目录，然后在其中输入Regsvr32 
                        x:\xxx\xxx\copyhook.dll 
                        ，其中x:\xxx\xxx\是编译的CopyHook.dll所在的全路径名。也可以在Run菜单中选择Register 
                        ActiveX 
                        Server来注册。<BR>当文件注册成功之后，在Windows的Explore中任意改变一个文件夹的名字或者移动一个目录，就会有一个提示框弹出，提示用户是否确定执行操作。如图所示：<BR><BR><BR><BR>按“是”将执行文件夹操作，按“否”或者“取消”将取消相应的文件夹操作。<BR>上面介绍的只是Delphi实现Windows外壳扩展的一种，参照上面的程序和Delphi关于Windows的COM组件模型的编程，就可以编写出十分专业化的Windows外壳扩展程序。<BR><BR><BR><BR><BR><BR></TD></TR></TBODY></TABLE></TD></TR>
              <TR align=right>
                <TD colSpan=2>责任编辑：VCRoad(朱彦力)&nbsp;（共计 748 篇） </TD></TR>
              <TR>
                <TD colSpan=2></TD></TR>
              <TR>
                <TD colSpan=2>&nbsp; </TD></TR></TBODY></TABLE>
            <TABLE align=center border=0 cellPadding=0 cellSpacing=0 
width="98%">
              <TBODY>
              <TR>
                <TD><LINK href="利用Windows外壳扩展保护文件夹.files/style.css" 
                  rel=stylesheet type=text/css>
                  <FIELDSET> 
                  <LEGEND align=left>g 利用Windows外壳扩展保护文件夹 <FONT 
                  color=#ff0000><B>[回复数: 0]</B></FONT> d</LEGEND>
                  <TABLE bgColor=#ffffff border=0 borderColorLight=#ffffff 
                  cellSpacing=0 class=TableLine style="TABLE-LAYOUT: fixed" 
                  width="100%">
                    <TBODY></TBODY></TABLE></FIELDSET> </TD></TR>
              <TR>
                <TD height=9>
                  <SCRIPT language=JavaScript><!--
function Form1_Validator(theForm)
{
if (theForm.name.value == "")
{
alert("请输入您注册的会员名！");
theForm.name.focus();
return (false);
}

if (theForm.password.value == "")
{
alert("请输入密码！");
theForm.password.focus();
return (false);
}

if (theForm.name.value.length > 20)
{
alert("名字太长！至多20个字符");
theForm.name.focus();
return (false);
}

if (theForm.content.value == "")
{
alert("没有内容！");
theForm.content.focus();
return (false);
}

if (theForm.content.value.length > 1000)
{
alert("限制1000个字符！");
theForm.content.focus();
return (false);
}
return (true);
}
//--></SCRIPT>
                  <LINK href="利用Windows外壳扩展保护文件夹.files/style.css" rel=stylesheet 
                  type=text/css>
                  <FIELDSET> 
                  <LEGEND align=left>g 我要留言 d</LEGEND>
                  <TABLE align=center bgColor=#ffffff border=0 cellPadding=0 
                  cellSpacing=0 style="TABLE-LAYOUT: fixed" width="95%">
                    <FORM action=GBookSave.asp?PageName1=shownews&amp;NewsID=458 
                    method=post name=Form1 
                    onsubmit="return Form1_Validator(this)">
                    <TBODY>
                    <TR>
                      <TD width="100%">姓 名： <INPUT maxLength=16 name=name 
                        size=10> &nbsp;&nbsp;密 码： <INPUT name=password size=10 
                        type=password> <INPUT name=page type=hidden value=1> <A 
                        class=LeftMenu href="http://www.vcroad.net/userreg.asp" 
                        target=_blank>没有注册？</A></TD></TR>
                    <TR>
                      <TD style="WORD-WRAP: break-word" vAlign=top width="100%"><TEXTAREA cols=82 name=content rows=8></TEXTAREA></TD>
                    <TR>
                      <TD align=middle width="100%"><INPUT name=B1 type=submit value=提交> <INPUT name=B2 type=reset value=重写> 
                  </TD></TR></FORM></TBODY></TABLE></FIELDSET> 
                  <TABLE border=0 cellPadding=0 cellSpacing=0 height=6 
                  width="90%">
                    <TBODY>
                    <TR>
                      <TD></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD>
          <TD bgColor=#dddddd height=178 width="21%">
            <TABLE border=0 cellPadding=0 cellSpacing=1 height="100%" 
            width="100%">
              <TBODY>
              <TR>
                <TD height="1%">
                  <TABLE border=0 cellPadding=0 cellSpacing=1 width="100%">
                    <TBODY>
                    <TR>
                      <TD>
                        <TABLE align=center bgColor=#efefef border=0 
                        cellPadding=0 cellSpacing=0 width="100%">
                          <TBODY>
                          <TR>
                            <TD background=利用Windows外壳扩展保护文件夹.files/hline.gif 
                            height=1></TD></TR>
                          <TR>
                            <TD bgColor=#efefef class=maintitle height=18 
                            width="100%">&nbsp;相关信息：SDK文件系统</TD></TR>
                          <TR>
                            <TD background=利用Windows外壳扩展保护文件夹.files/hline.gif 
                            height=1></TD></TR>
                          <TR>
                            <TD bgColor=#ffffff>
                              <TABLE border=0 cellPadding=0 cellSpacing=5 
                              style="TABLE-LAYOUT: fixed" width="100%">
                                <TBODY>
                                <TR>
                                <TD style="WORD-WRAP: break-word">・&nbsp;<A 
                                class=MainContentS 
                                href="http://www.vcroad.net/shownews.asp?newsid=942" 
                                target=_blank 
                                title="">用递归写Win32的文件夹遍历</A>&nbsp;<FONT 
                                class=TitleMore><FONT 
                                class=TitleMore>2003-1-16</FONT></FONT><BR>・&nbsp;<A 
                                class=MainContentS 
                                href="http://www.vcroad.net/shownews.asp?newsid=720" 
                                target=_blank 
                                title=在VC++下对文件属性的获取与更改>在VC++下对文件属性的获取与…</A>&nbsp;<FONT 
                                class=TitleMore><FONT 
                                class=TitleMore>2002-10-31</FONT></FONT><BR>・&nbsp;<A 
                                class=MainContentS 
                                href="http://www.vcroad.net/shownews.asp?newsid=572" 
                                target=_blank title="">目录监视程序</A>&nbsp;<FONT 
                                class=TitleMore><FONT 
                                class=TitleMore>2002-10-25</FONT></FONT><BR>・&nbsp;<A 
                                class=MainContentS 
                                href="http://www.vcroad.net/shownews.asp?newsid=462" 
                                target=_blank 
                                title="">VB中得到当前目录API定义</A>&nbsp;<FONT 
                                class=TitleMore><FONT 
                                class=TitleMore>2002-10-16</FONT></FONT><BR>・&nbsp;<A 
                                class=MainContentS 
                                href="http://www.vcroad.net/shownews.asp?newsid=456" 
                                target=_blank 
                                title="">SDK实现简单的文件拷贝等操作</A>&nbsp;<FONT 
                                class=TitleMore><FONT 
                                class=TitleMore>2002-10-16</FONT></FONT><BR></TD></TR>
                                <TR>
                                <TD align=right width="98%"><A class=MainMore 
                                href="http://www.vcroad.net/showsearch.asp?keyword=SDK文件系统" 
                                target=_blank>&gt;&gt;搜索更多</A>&nbsp;</TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
                        <TABLE border=0 cellPadding=0 cellSpacing=0 height=6 
                        width="90%">
                          <TBODY>
                          <TR>
                            <TD></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
                  <P></P>
                  <TABLE border=0 cellPadding=0 cellSpacing=1 width="100%">
                    <TBODY>
                    <TR>
                      <TD height=17 width="30%">
                        <DIV align=right><IMG height=18 
                        src="利用Windows外壳扩展保护文件夹.files/err.gif" 
width=18></DIV></TD>
                      <TD height=17 width="70%"><A class=MainContentS 
                        href="http://www.vcroad.net/forum/list.asp?boardid=10" 
                        target=_blank>举报网站错误</A></TD></TR></TBODY></TABLE><BR><BR>
                  <TABLE border=1 borderColorDark=#ffffff 
                  borderColorLight=#cccccc cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR bgColor=#e4e4e4>
                      <TD height=4>
                        <DIV align=center><FONT size=2><IMG height=12 
                        src="利用Windows外壳扩展保护文件夹.files/arrow2.gif" width=24> 
                        开发论坛</FONT></DIV></TD></TR></TBODY></TABLE>
                  <TABLE align=center border=0 cellPadding=0 cellSpacing=0 
                  width="59%">
                    <TBODY>
                    <TR>
                      <TD>
                        <DIV align=right><A class=MainContentS 
                        href="http://www.vcroad.net/forum/list.asp?boardid=4" 
                        target=_blank>SDK 编程论坛</A></DIV></TD></TR>
                    <TR>
                      <TD>
                        <DIV align=right><A class=MainContentS 
                        href="http://www.vcroad.net/forum/list.asp?boardid=3" 
                        target=_blank>C/CPP 编程论坛</A></DIV></TD></TR>
                    <TR>
                      <TD>
                        <DIV align=right><A class=MainContentS 
                        href="http://www.vcroad.net/forum/list.asp?boardid=5" 
                        target=_blank>VC/MFC 编程论坛</A></DIV></TD></TR>
                    <TR>
                      <TD>
                        <DIV align=right></DIV></TD></TR>
                    <TR>
                      <TD height=23>
                        <DIV align=right></DIV></TD></TR></TBODY></TABLE><BR>
                  <DIV align=center><FONT size=2><SPAN class=MainContentS><IMG 
                  height=16 src="利用Windows外壳扩展保护文件夹.files/hf.gif" 
                  width=16></SPAN></FONT> <A class=MainContentS 
                  href="mailto:vcroad@sina.com">我要投稿</A></DIV></TD></TR>
              <TR>
                <TD height=8>
                  <DIV 
      align=center></DIV></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><LINK 
      href="利用Windows外壳扩展保护文件夹.files/style.css" rel=stylesheet type=text/css>
      <TABLE border=0 cellPadding=0 cellSpacing=0 width="98%">
        <TBODY>
        <TR>
          <TD bgColor=#ffffff width="1%"></TD>
          <TD width="1%">
          <TD align=middle class=top4 height=12 
          style="BORDER-TOP: #000000 1px double" width="96%">| <A class=top4 
            href="http://www.vcroad.net/shownews.asp?newsid=458#" 
            onclick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://www.vcroad.com');">设为首页</A> 
            | <A class=top4 
            href="http://www.vcroad.net/shownews.asp?newsid=458#" 
            onclick="javascript:window.external.AddFavorite('http://www.vcroad.com', 'VC之路：：综合软件开发网站，以VC++编程为主')">加入收藏</A> 
            | <A class=top4 href="mailto:vcroad@sina.com">联系我们</A> | <A 
            class=top4 href="mailto:wutao8@263.net">联系枣子</A> | <A class=top4 
            href="http://www.vcroad.net/tougao.asp" target=admin>投稿说明</A> | <A 
            class=top4 href="http://www.vcroad.net/forum/" target=admin>开发社区</A> 
            |</TD>
          <TD width="1%"></TD>
          <TD bgColor=#ffffff width="1%"></TD></TR></TBODY></TABLE>
      <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
        <TBODY>
        <TR>
          <TD height=18>
            <DIV align=center><FONT size=-1><SPAN class=text>CopyRight by VCROAD 
            &copy;2000-2002 All Right 
  Reserve</SPAN></FONT></DIV></TD></TR></TBODY></TABLE></TR></TBODY></DIV></BODY></HTML>
